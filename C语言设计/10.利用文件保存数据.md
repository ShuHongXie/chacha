### C 文件的有关概念

0. 文件类型：**数据文件**，**程序文件**
1. 程序文件：包括源文件(.c)，目标文件(.obj)，可执行文件(.exe)，这种文件是用来存放程序的，以便实现程序的功能。
2. 数据文件：**供程序运行时读写的数据**。
3. 文件：**存储在外部介质上数据的集合**，如：磁盘，U 盘等。
4. 输入输出流：**表示了信息从源到目的端的流动**。输入操作时，数据从文件流向计算机内存，输出操作时，数据从计算机流向文件(如打印机，磁盘)
5. 流式文件：以字节为单位的文件，由一连串字节组成，中间没有分隔符，对文件的存取是以字节为单位的文件。
6. 数据文件的分类：**ASCII 文件**，也称作文本文件和**二进制文件**
7. 文件标识：**文件路径，文件主干，文件后缀**
   - ![](https://blog-1300014307.cos.ap-guangzhou.myqcloud.com/202311271554481.png)
8. 文件缓冲系统：系统自动在内存区为程序中每一个正在使用的文件开辟一个**文件缓冲区**。
9. 文件缓冲区：系统在读写程序时在内存中开辟的数据源与数据目标中间的一个用于保存完整数据内容的缓冲区域。
10. 文件类型指针：**在打开文件时，会在内存建立一个文件信息区，存放文件的有关特征和当前状态。这个信息的数据组织成结构体类型，系统将其命名了 FILE 类型。文件类型就是指向文件结构体类型变量的指针，即指向 FILE 文件类型的指针**
11. 通过文件指针访问文件的好处：可以随机访问文件，有效表示数据结构，动态分配内存，方便使用字符串，有效使用数组。
12. 文件信息区：用来存放文件的有关信息(如文件名，文件状态，文件当前位置等)，系统将其命名为 FILE 类型
13. 文件的打开和关闭：所谓的“打开”是指为文件建立相应的信息区和文件缓冲区。“关闭”是指撤销文件信息区和文件缓冲区，使文件指针变量不再指向该文件。

### 文件名

文件名包括三部分的文件标识

例如：d:\cc\temp\file1.dat

1. 文件路径 => d:\cc\temp\
2. 文件名主干 => file1
3. 文件后缀 => .dat （一般不超过 3 个字母）

### 数据文件分类

1. **ASCII 文件**：又称 text 文件，每一个字节存放一个字符的 ASCII 代码
2. **二进制文件**：把内存中的数据按其在内存中的存储形式原样输出到磁盘上存放

```c
/**
 * 比如 10000用ASCII形式存储到键盘上，则需要占5个字节(一个字符占1一个字节)，
 * 而用二进制形式输出，则在磁盘上只占2个字节
 */
```

### 文件缓冲区

1. 定义：C 语言采用"**缓冲文件系统**"处理文件，是指系统自动在内存区为程序中每一个正在使用的文件开辟一个**文件缓冲区**，从内存中向磁盘输出数据必须先送到内存中的缓冲区，装满缓冲区后才送到磁盘，如果从磁盘向内存中读入数据，则一次从磁盘文件将一批数据输入到内存缓冲区(充满缓冲区)，然后再从缓冲区逐个地将数据送到程序数据区(给程序变量)，缓冲区大小由各个具体的 C 编译系统确定。
2. 为什么要用缓冲区？ 缓冲区是为了让低速的输入输出设备和高速的用户程序能够协调工作，并降低输入输出设备的读写次数。

   - 例如，我们都知道硬盘的速度要远低于 CPU，它们之间有好几个数量级的差距，当向硬盘写入数据时，程序需要等待，不能做任何事情，就好像卡顿了一样，用户体验非常差。计算机上绝大多数应用程序都需要和硬件打交道，例如读写硬盘、向显示器输出、从键盘输入等，如果每个程序都等待硬件，那么整台计算机也将变得卡顿。

   - 但是有了缓冲区，就可以将数据先放入缓冲区中（内存的读写速度也远高于硬盘），然后程序可以继续往下执行，等所有的数据都准备好了，再将缓冲区中的所有数据一次性地写入硬盘，这样程序就减少了等待的次数，变得流畅起来。

### 文件指针类型

1. 定义：缓冲文件系统中，关键的是文件类型指针，简称**文件指针**，每个被使用的文件都在内存中开辟一个相应的**文件信息区**，用来存放文件的有关信息(如文件名，文件状态，文件当前位置等)。这些信息是保存在一个结构体变量中的，该结构体变量由系统声明存放在头文件"stdio.h"中，叫 FILE，在程序中可以直接使用 FILE 类型定义名词。

```c
// 定义file类型变量
FILE F;
// 定义指向文件型数据的指针变量：
FILE *fp;
```

### 文件的打开和关闭

1. fopen(文件名，使用文件方式:r/w/a/rb/wb/ab/r+/w+/a+/rb+/wb+/ab+) 失败返回 NULL，成功返回文件首地址。**使用 fopen 时，若以"读"的模式打开，文件必须存在；若以"写"的模式(只要含有 w)打开时，文件可以不存在，会自动创建**
2. fclose(文件指针) 成功返回 0，失败返回 EOF(-1)，**关闭就是撤销文件信息区和文件缓冲区，使文件指针变量不再指向该文件，使文件指针变量与文件脱钩，此后不能通过该指针对原来与其相联系的文件进行读写，**，**如前所述,在向文件写数据时,是先将数据输出到缓冲区,待缓冲区充满后才正式输出给文件。如果当数据未充满缓冲区而程序结束运行,就会将缓冲区中的数据丢失。用 fclose 函数关闭文件,可以避免这个问题,它先把缓冲区中的数据输出到磁盘文件,然后才释放文件指针变量。**

```c
FILE *fp;
fp = fopen("a1", "r");
fclose(fp);

```

### 文件的顺序读写

#### 向文件读取字符

1. fgetc(fp)： 从 fp 指向的文件读入一个字符，成功返回所读字符，失败返回 EOF
2. fputc(ch, fp)：把字符 ch 写到文件指针变量 fp 所指向的文件中，成功返回输出字符，失败返回 EOF，**写入时会清空文件原有的文本**
3. feof(in)：检测文件尾标志 EOF 是否已被读过。被读过表示文件有效字符已全部读完，返回 1，否则返回 0
4. 文件读取为什么是按顺序的：访问磁盘文件是逐个字节进行的，为了知道当前访问到第几自己，系统用**文件读写位置标记**来表示**当前所访问的位置**，每访问完一个字节后，当前位置标记就指向下一字节。为了知道对文件的访问是否完成，在一个文件的有效字符的后面一字节中，系统自动设置了一个**文件尾标志**，用 EOF 表示,在 stdio 头文件 EOF 被定义为-1，当读完全部有效字符后，读写位置标记就指向 EOF，再执行一次读操作就读入 EOF,这个时候表示有效字符已经读完。

#### 向文件读取字符串

1. fgets(str,n ,fp)：从 fp 指向的文件中读入一个长度为 n-1 的字符串，存放到字符数组 str 中。成功返回 str 数组首元素, 失败返回 NULL,**在读完一个字符前遇到\n 或 EOF,读入即结束，但将所遇到的换行符\n 也作为一个字符读入**
2. fputs(ch, fp)：把字符 str 写到文件指针变量 fp 所指向文件中，输出成功返回 0，失败返回非 0 值

#### 文件的格式化读写

1. fprintf(文件指针，格式字符串，输出表列)；对文件按格式进行输出输出到指定文件
2. fscanf(文件指针，格式字符串，输入表列)

```c
// 例如 将整形变量i和实型变量f按照%d和%6.2f的格式输出到fp指向的文件中
fprint(fp, "%d,%6.2f", i ,f);
```

#### 用二进制方式读写文件

buffer: 一个地址，对于 fread 来说，是读入数据的存放地址，对 fwrite 来说是输出数据的地址
size: 要读写的字节数
count: 要进行读写多少个 size 字节的数据线
fp：文件型指针

1. 读：fread(buffer,size,count, fp);
2. 写：fwrite(buffer,size,count,fp);

### 文件的随机读写

使用 rewind 函数使文件位置标记指向文件头

1. 重置文件位置标记：rewind(文件类型指针)
2. 移动文件位置标记，改变文件位置标记的位置：fseek(文件类型指针，位移量，起始点)
3. 测定文件位置标记的当前位置(从文件头开始)：ftell(fp)，如果返回-1L 那表示出错，如果函数调用时出错那返回 error

```c
//    起始点        名字          用数字代表
//   文件开始       SEEK_SET          0
//文件位置标记当前位置 SEEK_CUR         1
//    文件末尾      SEEK_END          2
fseek(fp, 100L, 0); // 将文件位置标记移到离文件头100字节处
fseek(fp, 50L, 1); // 将文件位置标记移到离当前位置后面50字节处
fseek(fp, -10L, 2); // 将文件位置标记从文件末尾处向后退10字节
```

### 系统自定义的文件类型指针

3 个**标准文件**指针，**为了方便用户，系统在程序开始运行时，自动打开下面 3 个标准文件**

1. stdin(标准输入文件指针)，指向在内存中与**键盘**相对应的文件信息区，因此用他进行输入就蕴含了**键盘输入**
2. stdout(标准输出文件指针)，指向在内存中与**显示器屏幕**相对应的文件显示区
3. stderr(标准出错文件指针)，用来输出出错的信息，指向在内存中和**显示器屏幕**相应的文件显示器，因为，在程序运行出错时的信息就输出到显示器屏幕。
4. stdprn(标准打印文件)，一般指打印机。

### fread 和 fwrite 用于二进制文件的输入输出

### 文件读写的出错检测

1. ferror 函数：可以用 ferror 函数检查输入输出函数的错误，调用方式为 ferror(fp)；返回 0 时表示为出错，返回非 0 值表示出错，执行 fopen 时 ferror 的函数初始值默认为 0
2. clearerr，

### 各函数返回值分类

- fclose: **关闭 fp 所指的文件，释放文件缓冲区**，完成返回 0，出错返回非 0
- feof：**检查文件是否结束**，没检测完返回 0，检测完返回非 0
- fget：**从 fp 所指定的文件中取得下一个字符**，成功返回所得字符，出错返回 EOF
- fgets：**从 fp 指向的文件读取一个长度为(n 一 1)的字符串,存入起始地址为 buf 的空间**，成功返回地址 buf，失败或出错返回 NULL
- fputc: **将字符 ch 输出到 fp 指向的文件中**，成功返回该字符，失败返回非 0
- fputs：**将 str 指向的字符串输出到 p 所指定的文件**，成功返回 0，失败返回非 0
- getchar：**从标准输入设备读取下一个字符**，成功返回所读字符，文件结束或出错返回-1
- putchar：**把字符 ch 输出到标准输出设备**，输出的字符 ch。若出错,返回 EOF
- fopen: **以 mode 指定的方式打开名为 filename 的文件**，成功返回文件指针，失败返回 0
